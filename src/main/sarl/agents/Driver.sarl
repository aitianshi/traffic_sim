/** 
 * 
 */
package agents

import org.arakhne.afc.gis.road.primitive.RoadNetwork
import org.arakhne.afc.math.geometry.d2.d.Point2d
import road_elements.Car
import road_elements.GPS
import road_elements.Road
import events.Perception
import events.Influence
import io.sarl.core.Logging
import io.sarl.core.DefaultContextInteractions
import events.ArrivedAtEndRoad
import io.sarl.core.Initialize
import java.util.ArrayList
import events.ArrivedAtDestination
import io.sarl.core.Lifecycle
import events.MoveForward

/** 
 * @author robin
 * 
 */
agent Driver {
	uses Logging
	uses DefaultContextInteractions
	uses Lifecycle
	
	protected var currentPoint : Point2d
	protected var arrivalPoint : Point2d
	protected var car : Car
	protected var speed : int
	protected var gps : GPS

	synchronized def initProperties(car : Car, arrivalPoint : Point2d, network : RoadNetwork) : void {
		this.car=car
		this.currentPoint = this.car.coordinates
		this.arrivalPoint = arrivalPoint
		this.speed = 0
		this.gps=new GPS(this.currentPoint,this.arrivalPoint,network)
	}

	on ArrivedAtEndRoad {
		synchronized (this) {
			var nextRoadToTake : Road 
			nextRoadToTake = this.gps.nextRoad
			this.car.road = nextRoadToTake
			this.car.pos1D=0
		}
		emit(new Influence(this.ID, this.arrivalPoint))
	}
	
	on ArrivedAtDestination{
		this.car.removeFromLayer
		killMe
	}

	on MoveForward {
		Thread.sleep(500)
		emit(new Influence(this.ID, this.arrivalPoint))

	}
	
	def getCurrentPoint:Point2d{
		return this.currentPoint
	}

	def getArrivalPoint : Point2d { 
		return this.arrivalPoint
	}

	on Initialize {
		// emit(new AgentDeparture)
	}	
}
